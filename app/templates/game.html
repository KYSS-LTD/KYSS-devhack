{% extends 'base.html' %}

{% block title %}Игра {{ pin }}{% endblock %}

{% block body_overflow_class %}overflow-y-auto{% endblock %}

{% block card %}
    <div class="absolute inset-0 rounded-3xl pointer-events-none bg-gradient-to-br from-white/40 to-transparent dark:from-white/5"></div>

    <div class="relative space-y-6">
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4 border-b border-slate-200 dark:border-slate-700 pb-4">
            <div>
                <h2 class="text-xl font-bold text-slate-800 dark:text-white">Комната <span class="text-indigo-500" id="pin">{{ pin }}</span></h2>
                <p id="topic" class="text-sm text-slate-500">Загрузка темы...</p>
            </div>
            <div class="flex gap-2">
                <a href="/" class="px-3 py-1.5 text-xs font-medium rounded-lg border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 transition">На главную</a>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-red-50 dark:bg-red-900/20 p-3 rounded-2xl text-center border border-red-100 dark:border-red-800/30">
                <span class="block text-xs uppercase tracking-wider text-red-500 font-semibold">Красные</span>
                <span id="score-a" class="text-3xl font-black text-red-600 dark:text-red-400">0</span>
            </div>
            <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-2xl text-center border border-blue-100 dark:border-blue-800/30">
                <span class="block text-xs uppercase tracking-wider text-blue-500 font-semibold">Синие</span>
                <span id="score-b" class="text-3xl font-black text-blue-600 dark:text-blue-400">0</span>
            </div>
        </div>

        <div class="text-center space-y-2">
            <p id="turn" class="text-sm font-medium text-slate-600 dark:text-slate-300">Ожидание игроков...</p>
            <div id="timer" class="inline-block px-4 py-1 rounded-full bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300 text-sm font-mono font-bold"></div>
        </div>

        <div id="question-area" class="space-y-4 py-4">
            <div class="text-center">
                <h3 id="question-title" class="text-indigo-500 text-xs font-bold uppercase tracking-widest mb-1">Вопрос</h3>
                <div id="question-text" class="text-lg font-medium text-slate-800 dark:text-slate-100 leading-snug">
                    Здесь появится вопрос после начала игры
                </div>
            </div>

            <div id="vote-stats" class="text-[10px] text-center uppercase tracking-tighter text-slate-400 h-4"></div>

            <div id="answers" class="grid grid-cols-1 gap-2">
                </div>

            <p id="answer-result" class="text-center text-sm font-bold"></p>
        </div>

        <div id="lobby-section" class="bg-slate-50 dark:bg-slate-800/50 rounded-2xl p-4 border border-slate-200 dark:border-slate-700">
            <h4 class="text-xs font-bold uppercase text-slate-400 mb-3 tracking-widest">Участники</h4>
            <ul id="lobby-list" class="space-y-1 text-sm text-slate-600 dark:text-slate-300"></ul>
        </div>

        <div id="team-section" class="grid grid-cols-2 gap-4 hidden">
            <div class="space-y-2">
                <h4 class="text-[10px] font-bold uppercase text-red-400 tracking-widest text-center">Команда А</h4>
                <ul id="team-a-list" class="text-xs space-y-1"></ul>
            </div>
            <div class="space-y-2">
                <h4 class="text-[10px] font-bold uppercase text-blue-400 tracking-widest text-center">Команда B</h4>
                <ul id="team-b-list" class="text-xs space-y-1"></ul>
            </div>
        </div>

        <div class="space-y-3 pt-4 border-t border-slate-200 dark:border-slate-700">
            
            <button id="start-btn" class="hidden w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition active:scale-95">
                Начать игру
            </button>

            <div id="captain-controls" class="hidden p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-800/30 rounded-xl space-y-2">
                <p class="text-[10px] font-bold text-amber-600 uppercase">Корона капитана</p>
                <div class="flex gap-2">
                    <select id="captain-select" class="flex-1 bg-white dark:bg-slate-900 border border-amber-200 dark:border-amber-800 text-xs rounded-lg px-2 py-1 outline-none"></select>
                    <button id="transfer-captain-btn" class="px-3 py-1 bg-amber-500 text-white text-xs rounded-lg font-semibold hover:bg-amber-600 transition">Передать</button>
                </div>
            </div>

            <div id="host-controls" class="hidden p-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl space-y-3">
                <p class="text-[10px] font-bold text-slate-500 uppercase">Панель ведущего</p>
                <div class="grid grid-cols-3 gap-2">
                    <button id="pause-btn" class="p-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-xs hover:bg-slate-50 transition">Пауза</button>
                    <button id="resume-btn" class="p-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-xs hover:bg-slate-50 transition">Пуск</button>
                    <button id="next-question-btn" class="p-2 bg-indigo-500 text-white rounded-lg text-xs hover:bg-indigo-600 transition">Далее</button>
                </div>
                <div class="flex gap-2">
                    <select id="kick-player-select" class="flex-1 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-xs rounded-lg px-2 py-1 outline-none"></select>
                    <button id="kick-btn" class="px-3 py-1 bg-red-500 text-white text-xs rounded-lg font-semibold hover:bg-red-600 transition">Кик</button>
                </div>
            </div>

            <div id="restart-controls" class="hidden space-y-3 animate-in fade-in duration-500">
                <input id="restart-topic" type="text" placeholder="Новая тема..." class="w-full bg-transparent border border-slate-300 dark:border-slate-700 rounded-xl px-4 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition" />
                <select id="restart-difficulty" class="w-full bg-transparent border border-slate-300 dark:border-slate-700 rounded-xl px-4 py-2 text-sm outline-none transition cursor-pointer">
                    <option value="easy">Простой</option>
                    <option value="medium" selected>Средний</option>
                    <option value="hard">Сложный</option>
                </select>
                <button id="restart-btn" class="w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold transition active:scale-95">
                    Играть снова
                </button>
            </div>

            <button id="save-results-btn" class="hidden w-full py-2 border border-slate-300 dark:border-slate-700 text-slate-500 text-sm rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition">
                Скачать результаты (.txt)
            </button>
        </div>
    </div>

    <script>window.QUIZBATTLE_PIN = "{{ pin }}";</script>
    <script src="/static/js/game.js"></script>
{% endblock %}